<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.emucoo.mapper.TFrontPlanMapper" >
  <resultMap id="BaseResultMap" type="com.emucoo.model.TFrontPlan" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="loop_plan_id" property="loopPlanId" jdbcType="BIGINT" />
    <result column="shop_id" property="shopId" jdbcType="BIGINT" />
    <result column="plan_date" property="planDate" jdbcType="DATE" />
    <result column="status" property="status" jdbcType="BIT" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="plan_precise_time" property="planPreciseTime" jdbcType="VARCHAR" />
    <result column="report_id" property="reportId" jdbcType="BIGINT" />
    <result column="check_form_ids" property="checkFormIds" jdbcType="VARCHAR" />
    <result column="remind_type" property="remindType" jdbcType="BIT" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="actual_execute_time" property="actualExecuteTime" jdbcType="VARCHAR" />
    <result column="actual_execute_address" property="actualExecuteAddress" jdbcType="VARCHAR" />
    <result column="actual_remind_time" property="actualRemindTime" jdbcType="TIMESTAMP" />
    <result column="arranger_id" property="arrangerId" jdbcType="BIGINT" />
    <result column="arrangee_id" property="arrangeeId" jdbcType="BIGINT" />
    <result column="sub_plan_id" property="subPlanId" jdbcType="BIGINT"/>
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="modify_user_id" property="modifyUserId" jdbcType="BIGINT" />
    <result column="is_del" property="isDel" jdbcType="BIT" />
    <result column="org_id" property="orgId" jdbcType="BIGINT" />
    <association property="shop" javaType="com.emucoo.model.TShopInfo">
      <id column="shop_id" property="id" jdbcType="BIGINT"/>
      <result column="shop_name" property="shopName" jdbcType="VARCHAR"/>
    </association>
  </resultMap>

  <select id="countTodayPlanOfUser" resultType="java.lang.Integer" >
    select count(id)
    from t_front_plan
    where arrangee_id=#{userId} and status=0 and DATE_FORMAT(plan_date,'%Y-%m-%d') = #{today}
  </select>

  <select id="listTodayPlanOfUser" resultMap="BaseResultMap">
    select * from t_front_plan
    where arrangee_id=#{userId} and status=0 and DATE_FORMAT(plan_date,'%Y-%m-%d') = #{today}
  </select>

  <insert id="addUnArrangeToPlan" parameterType="com.emucoo.model.TFrontPlan">
    INSERT INTO t_front_plan
    (
      shop_id,
      sub_plan_id,
      status,
      arrange_year,
      arrange_month,
      create_time,
      modify_time,
      create_user_id,
      modify_user_id,
      org_id,
      is_del
    ) values (
      #{shop.id},
      #{subPlanId},
      #{status},
      #{arrangeYear},
      #{arrangeMonth},
      #{createTime},
      #{modifyTime},
      #{createUserId},
      #{modifyUserId},
      #{orgId},
      #{isDel}
    )
  </insert>

  <select id="findArrangeListByAreaId" resultMap="BaseResultMap">
    SELECT
    plan.id,
    plan.plan_date,
    plan.status,
    plan.shop_id,
    plan.sub_plan_id,
    shopinfo.shop_name
    from t_front_plan plan
    INNER JOIN t_shop_info shopinfo
    ON plan.shop_id = shopinfo.id
    WHERE plan.shop_id in
    (
      SELECT
      shop.id
      from t_shop_info shop WHERE shop.area_id = #{areaId}
    )
    AND plan.arrange_year = #{year} AND plan.arrange_month = #{month}
  </select>
</mapper>